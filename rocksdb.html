<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="keywords" content="">
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
	<link rel="canonical" href="https://paragroup.github.io/WindFlow/rocksdb.html">
    <link rel="shortcut icon" type="image/png" href="favicon.png">
    
	<link rel="stylesheet" type="text/css" href="./css/bootstrap.min.css?5195">
	<link rel="stylesheet" type="text/css" href="style.css?6586">
	<link rel="stylesheet" type="text/css" href="./css/prism.css?5155">
	
	
    <title>RocksDB</title>


    
<!-- Analytics -->
 
<!-- Analytics END -->
    
</head>
<body>

<!-- Preloader -->
<div id="page-loading-blocs-notifaction" class="page-preloader"></div>
<!-- Preloader END -->


<!-- Main container -->
<div class="page-container">
    
<!-- bloc-0 -->
<div class="bloc l-bloc" id="bloc-0">
	<div class="container bloc-sm">
		<div class="row">
			<div class="col">
				<nav class="navbar navbar-light row navbar-expand-md" role="navigation">
					<a class="navbar-brand" href="index.html">WindFlow</a>
					<button id="nav-toggle" type="button" class="ml-auto ui-navbar-toggler navbar-toggler border-0 p-0" data-toggle="collapse" data-target=".navbar-48557" aria-expanded="false" aria-label="Toggle navigation">
						<span class="navbar-toggler-icon"><svg height="32" viewBox="0 0 32 32" width="32"><path class="svg-menu-icon " d="m2 9h28m-28 7h28m-28 7h28"></path></svg></span>
					</button>
					<div class="collapse navbar-collapse navbar-48557">
							<ul class="site-navigation nav navbar-nav ml-auto">
								<li class="nav-item">
									<a href="index.html" class="btn btn-lg btn-glossy btn-c-4866">Home</a>
								</li>
								<li>
									<a href="operators.html" class="btn btn-lg btn-glossy btn-c-4866">Operators</a>
								</li>
								<li>
									<a href="usage.html" class="btn btn-lg btn-glossy btn-c-4866">API<br></a>
								</li>
								<li>
									<a href="usage_gpu.html" class="btn btn-lg btn-glossy btn-c-4866">API GPU</a>
								</li>
								<li>
									<a href="kafka.html" class="btn btn-lg btn-glossy btn-c-4866">API Kafka<br></a>
								</li>
								<li>
									<a href="rocksdb.html" class="btn btn-lg btn-glossy btn-c-4866">API RocksDB<br></a>
								</li>
								<li>
									<a href="dashboard.html" class="btn btn-lg btn-glossy btn-c-4866">Dashboard</a>
								</li>
								<li>
									<a href="https://github.com/ParaGroup/WindFlow/archive/refs/tags/v4.0.0.zip" class="btn btn-lg btn-glossy btn-c-4866">Download</a>
								</li>
								<li>
									<a href="about.html" class="btn btn-lg btn-glossy btn-c-4866">About</a>
								</li>
							</ul>
						</div>
				</nav>
			</div>
		</div>
	</div>
</div>
<!-- bloc-0 END -->

<!-- bloc-1 -->
<div class="bloc none l-bloc" id="bloc-1">
	<div class="container bloc-no-padding">
		<div class="row bgc-4866">
			<div class="order-md-0 col-md-12 col-lg-6 order-lg-1 offset-lg-1">
				<picture><source type="image/webp" srcset="img/logo_white.webp"><img src="img/logo_white.png" class="img-fluid img-style float-lg-none" alt="logo_white" width="500" height="310"></picture>
			</div>
			<div class="align-self-center offset-md-1 col-md-10 col-lg-4 col-sm-10 offset-sm-1 col-10 offset-1">
				<h4 class="mg-md tc-6038 btn-resize-mode h2-style float-lg-right">
					A C++17 Data Stream Processing Parallel Library for Multicores and GPUs&nbsp;<br>
				</h4>
			</div>
		</div>
	</div>
</div>
<!-- bloc-1 END -->

<!-- bloc-8 -->
<div class="bloc l-bloc" id="bloc-8">
	<div class="container bloc-lg">
		<div class="row">
			<div class="col">
				<h2 class="mg-md tc-3327">
					<strong>RocksDB Integration</strong>
				</h2>
				<p class="text-justify">
					WindFlow, starting from version 4.0, provides an integration with the&nbsp;<a href="https://rocksdb.org/">RocksDB</a>&nbsp;Key-Value Store (KVS). This allows a suite of new operators to maintain a state object per key on RocksDB. The general scenario for using such operators is in the case of “<strong>larger-than-memory state</strong>” applications, where the state of the operators is larger than the available memory of the machine. The supported persistent operators are the basic ones (P_Map, P_Filter, P_FlatMap, P_Reduce, and P_Sink) and a window-based operator (P_Keyed_Windows).
				</p>
				<p class="text-justify">
					The set of persistent operators are described in the figure below.
				</p><picture><source type="image/webp" srcset="img/lazyload-ph.png" data-srcset="img/p_operators.webp"><img src="img/lazyload-ph.png" data-src="img/p_operators.jpg" class="img-fluid mx-auto d-block img-kafka-operato-style lazyload" alt="kafka_operators" width="635" height="626"></picture>
				<h2 class="mg-md tc-3327">
					<strong>API Example</strong>
				</h2>
				<p class="text-justify">
					We show a very short example to integrate in a WindFlow application a <strong>P_FlatMap</strong> operator. The idea can be easily replicated with the other persistent operators. We define the type of the input tuple and of the state object:
				</p>
				<div>
					<pre><code class="language-cpp">
struct tuple_t // Struct of the input tuple
{
    size_t key;
    int64_t value;
};

struct state_t // Struct of the state object per key
{
	...
};
</code></pre>
					
				</div>
				<p class="text-justify">
						Then, the user defines the business logic of the P_FlatMap by providing, for example, a functor object having the right signature expected by WindFlow:
					</p>
				<div>
						<pre><code class="language-cpp">
class P_FlatMap_Functor // P_FlatMap functor
{
public:
    // operator()
    void operator()(const tuple_t &t, state_t &state, Shipper<tuple_t> &shipper)
    {
        ... // we use the state object and the tuple to provide zero, one or more results.
        ... // The state can be modified and it is deserialized before and serialized after
        ... // the call of this function by the WindFlow runtime system
    }
};
</tuple_t></code></pre>
						
					</div>
				<p class="text-justify">
							Before calling this function for each input tuple, the WindFlow’s runtime system will deserialize the state object associated with the key attribute of the current tuple and passes it to the user function. After the execution, since the state object might be modified, it will be serialized and written again to the KVS.
						</p>
				<p>
							The user creates the operators and the PipeGraph environment as usual. Furthermore, it creates the P_FlatMap operator using its builder. Before doing that, serialization and deserialization functions of the state objects should be provided (in the example below as two lambda functions):
						</p>
				<div>
							<pre><code class="language-cpp">
int main()
{
	...
	auto serializer = [](state_t &s) -> std::string {
        ... // serialization function
    };
    auto deserializer = [](std::string &s) -> state_t {
        ... // deserialization function
    };

    ...

    P_FlatMap_Functor func;
    P_FlatMap op = P_FlatMap_Builder(p_flatmap_functor_kb)
                        .withName("name_op")
                        .withParallelism(3) // example running with three replicas
                        .withOutputBatchSize(64) // each replica will produce 64 outputs per batch
                        .withKeyBy([](const tuple_t &t) -> size_t { return t.key; })
                        .withSerializer(serializer)
                        .withDeserializer(deserializer)
                        .build();
    ...
}
</code></pre>
							
						</div>
				<p>
								The application is finally run as usual.
							</p>
			</div>
		</div>
	</div>
</div>
<!-- bloc-8 END -->

<!-- ScrollToTop Button -->
<button aria-label="Scroll to top button" class="bloc-button btn btn-d scrollToTop" onclick="scrollToTarget('1',this)"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 32 32"><path class="scroll-to-top-btn-icon" d="M30,22.656l-14-13-14,13"/></svg></button>
<!-- ScrollToTop Button END-->


<!-- bloc-8 -->
<div class="bloc l-bloc" id="bloc-8">
	<div class="container bloc-lg">
		<div class="row">
			<div class="col-md-3 col-sm-6">
				<h4 class="mg-md text-sm-left text-center">
					About
				</h4><a href="http://calvados.di.unipi.it/paragroup/" class="a-btn a-block footer-link ltc-4866">PPMs Group</a><a href="https://www.unipi.it/" class="a-btn a-block footer-link ltc-4866">University of Pisa</a>
			</div>
			<div class="col-md-3 col-sm-6">
				<h4 class="mg-md text-sm-left text-center">
					<br>
				</h4><a href="index.html" class="a-btn a-block footer-link"></a><a href="index.html" class="a-btn a-block footer-link"><br></a>
			</div>
			<div class="col-md-3 col-sm-6">
				<h4 class="mg-md text-sm-left text-center">
					<br>
				</h4><a href="index.html" class="a-btn a-block footer-link"><br></a><a href="index.html" class="a-btn a-block footer-link"></a>
			</div>
			<div class="col-md-3 col-sm-6">
				<h4 class="mg-md text-sm-left text-center">
					Get the library
				</h4><a href="https://github.com/ParaGroup/WindFlow/archive/refs/tags/v4.2.0.zip" class="a-btn a-block footer-link ltc-4866 ">Download</a><a href="https://github.com/ParaGroup/WindFlow" class="a-btn a-block footer-link ltc-4866">GitHub</a>
			</div>
		</div>
	</div>
</div>
<!-- bloc-8 END -->

</div>
<!-- Main container END -->
    


<!-- Additional JS -->
<script src="./js/jquery.min.js?2737"></script>
<script src="./js/bootstrap.bundle.min.js?4309"></script>
<script src="./js/blocs.min.js?2928"></script>
<script src="./js/lazysizes.min.js" defer></script>
<script src="./js/prism.js?1087"></script><!-- Additional JS END -->


</body>
</html>
